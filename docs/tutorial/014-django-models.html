<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Django models</title>
    <link href="book.css" rel="stylesheet" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="" name="description" />
    <meta content="HonKit 3.7.5" name="generator" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <link href="content/stylesheet.css" rel="stylesheet" type="text/css" />
    <link href="content/page_styles.css" rel="stylesheet" type="text/css" />
    <!-- Google tag (gtag.js) -->
    <script
      async=""
      src="https://www.googletagmanager.com/gtag/js?id=G-BN9REN07NH"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-BN9REN07NH");
    </script>
  </head>
  <body data-chapter="014-django-models">
    <header class="book-header">
      <h1 class="page-title">Django models</h1>
    </header>
    <main>
      <div class="page">
        <h2 class="calibre1" id="django-models">Django models</h2>
        <p class="calibre6">
          What we want to create now is something that will store all the posts
          in our blog. But to be able to do that we need to talk a little bit
          about things called
          <code class="calibre11"> objects </code>
          .
        </p>
        <h2 class="calibre7" id="objects">Objects</h2>
        <p class="calibre6">
          There is a concept in programming called
          <code class="calibre11"> object-oriented programming </code>
          . The idea is that instead of writing everything as a boring sequence
          of programming instructions, we can model things and define how they
          interact with each other.
        </p>
        <p class="calibre6">
          So what is an object? It is a collection of properties and actions. It
          sounds weird, but we will give you an example.
        </p>
        <p class="calibre6">
          If we want to model a cat, we will create an object
          <code class="calibre11"> Cat </code>
          that has some properties such as
          <code class="calibre11"> color </code>
          ,
          <code class="calibre11"> age </code>
          ,
          <code class="calibre11"> mood </code>
          (like good, bad, or sleepy ;)), and
          <code class="calibre11"> owner </code>
          (which could be assigned a
          <code class="calibre11"> Person </code>
          object – or maybe, in case of a stray cat, this property could be
          empty).
        </p>
        <p class="calibre6">
          Then the
          <code class="calibre11"> Cat </code>
          has some actions:
          <code class="calibre11"> purr </code>
          ,
          <code class="calibre11"> scratch </code>
          , or
          <code class="calibre11"> feed </code>
          (in which case, we will give the cat some
          <code class="calibre11"> CatFood </code>
          , which could be a separate object with properties, like
          <code class="calibre11"> taste </code>
          ).
        </p>
        <pre class="calibre13"><code class="calibre11">Cat
        --------
        color
        age
        mood
        owner
        purr()
        scratch()
        feed(cat_food)
        </code></pre>
        <pre class="calibre13"><code class="calibre11">CatFood
        --------
        taste
        </code></pre>
        <p class="calibre6">
          So basically the idea is to describe real things in code with
          properties (called
          <code class="calibre11"> object properties </code>
          ) and actions (called
          <code class="calibre11"> methods </code>
          ).
        </p>
        <p class="calibre6">
          How will we model blog posts then? We want to build a blog, right?
        </p>
        <p class="calibre6">
          We need to answer the question: What is a blog post? What properties
          should it have?
        </p>
        <p class="calibre6">
          Well, for sure our blog post needs some text with its content and a
          title, right? It would be also nice to know who wrote it – so we need
          an author. Finally, we want to know when the post was created and
          published.
        </p>
        <pre class="calibre13"><code class="calibre11">Post
        --------
        title
        text
        author
        created_date
        published_date
        </code></pre>
        <p class="calibre6">
          What kind of things could be done with a blog post? It would be nice
          to have some
          <code class="calibre11"> method </code>
          that publishes the post, right?
        </p>
        <p class="calibre6">
          So we will need a
          <code class="calibre11"> publish </code>
          method.
        </p>
        <p class="calibre6">
          Since we already know what we want to achieve, let's start modeling it
          in Django!
        </p>
        <h2 class="calibre7" id="django-model">Django model</h2>
        <p class="calibre6">
          Knowing what an object is, we can create a Django model for our blog
          post.
        </p>
        <p class="calibre6">
          A model in Django is a special kind of object – it is saved in the
          <code class="calibre11"> database </code>
          . A database is a collection of data. This is a place in which you
          will store information about users, your blog posts, etc. We will be
          using a SQLite database to store our data. This is the default Django
          database adapter – it'll be enough for us right now.
        </p>
        <p class="calibre6">
          You can think of a model in the database as a spreadsheet with columns
          (fields) and rows (data).
        </p>
        <h3 class="calibre12" id="creating-an-application">
          Creating an application
        </h3>
        <p class="calibre6">
          To keep everything tidy, we will create a separate application inside
          our project. It is very nice to have everything organized from the
          very beginning. To create an application we need to run the following
          command in the console (from
          <code class="calibre11"> djangogirls </code>
          directory where
          <code class="calibre11"> manage.py </code>
          file is):
        </p>
        <p class="calibre6"></p>
        <p class="calibre6">macOS and Linux:</p>
        <p class="calibre6"></p>
        <pre
          class="calibre13"
        ><code class="calibre11">(myvenv) ~/djangogirls$ python manage.py startapp blog
        </code></pre>
        <p class="calibre6"></p>
        <p class="calibre6">Windows:</p>
        <p class="calibre6"></p>
        <pre
          class="calibre13"
        ><code class="calibre11">(myvenv) C:\Users\Name\djangogirls&gt; python manage.py startapp blog
        </code></pre>
        <p class="calibre6">
          You will notice that a new
          <code class="calibre11"> blog </code>
          directory is created and it contains a number of files now. The
          directories and files in our project should look like this:
        </p>
        <pre class="calibre13"><code class="calibre11">djangogirls
        ├── blog
        │   ├── admin.py
        │   ├── apps.py
        │   ├── __init__.py
        │   ├── migrations
        │   │   └── __init__.py
        │   ├── models.py
        │   ├── tests.py
        │   └── views.py
        ├── db.sqlite3
        ├── manage.py
        ├── mysite
        │   ├── asgi.py
        │   ├── __init__.py
        │   ├── settings.py
        │   ├── urls.py
        │   └── wsgi.py
        ├── myvenv
        │   └── ...
        └── requirements.txt
        </code></pre>
        <p class="calibre6">
          After creating an application, we also need to tell Django that it
          should use it. We do that in the file
          <code class="calibre11"> mysite/settings.py </code>
          -- open it in your code editor. We need to find
          <code class="calibre11"> INSTALLED_APPS </code>
          and add a line containing
          <code class="calibre11"> 'blog', </code>
          just above
          <code class="calibre11"> ] </code>
          . So the final product should look like this:
        </p>
        <p class="calibre6"></p>
        <p class="calibre6">mysite/settings.py</p>
        <p class="calibre6"></p>
        <pre class="calibre13"><code class="calibre11">INSTALLED_APPS = [
            <span>'django.contrib.admin'</span>,
            <span>'django.contrib.auth'</span>,
            <span>'django.contrib.contenttypes'</span>,
            <span>'django.contrib.sessions'</span>,
            <span>'django.contrib.messages'</span>,
            <span>'django.contrib.staticfiles'</span>,
            <span>'blog'</span>,
        ]
        </code></pre>
        <h3 class="calibre12" id="creating-a-blog-post-model">
          Creating a blog post model
        </h3>
        <p class="calibre6">
          In the
          <code class="calibre11"> blog/models.py </code>
          file we define all objects called
          <code class="calibre11"> Models </code>
          – this is a place in which we will define our blog post.
        </p>
        <p class="calibre6">
          Let's open
          <code class="calibre11"> blog/models.py </code>
          in the code editor, remove everything from it, and write code like
          this:
        </p>
        <p class="calibre6"></p>
        <p class="calibre6">blog/models.py</p>
        <p class="calibre6"></p>
        <pre
          class="calibre13"
        ><code class="calibre11"><span>from</span> django.conf <span>import</span> settings
        <span>from</span> django.db <span>import</span> models
        <span>from</span> django.utils <span>import</span> timezone


        <span><span>class</span> <span>Post</span>(<span>models.Model</span>):</span>
            author = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
            title = models.CharField(max_length=<span>200</span>)
            text = models.TextField()
            created_date = models.DateTimeField(default=timezone.now)
            published_date = models.DateTimeField(blank=<span>True</span>, null=<span>True</span>)

            <span><span>def</span> <span>publish</span>(<span>self</span>):</span>
                self.published_date = timezone.now()
                self.save()

            <span><span>def</span> <span>__str__</span>(<span>self</span>):</span>
                <span>return</span> self.title
        </code></pre>
        <blockquote class="calibre5">
          <p class="calibre6">
            Double-check that you use two underscore characters (
            <code class="calibre11"> _ </code>
            ) on each side of
            <code class="calibre11"> str </code>
            . This convention is used frequently in Python and sometimes we also
            call them "dunder" (short for "double-underscore").
          </p>
        </blockquote>
        <p class="calibre6">
          It looks scary, right? But don't worry – we will explain what these
          lines mean!
        </p>
        <p class="calibre6">
          All lines starting with
          <code class="calibre11"> from </code>
          or
          <code class="calibre11"> import </code>
          are lines that add some bits from other files. So instead of copying
          and pasting the same things in every file, we can include some parts
          with
          <code class="calibre11"> from ... import ... </code>
          .
        </p>
        <p class="calibre6">
          <code class="calibre11"> class Post(models.Model): </code>
          – this line defines our model (it is an
          <code class="calibre11"> object </code>
          ).
        </p>
        <ul class="calibre9">
          <li class="calibre3">
            <code class="calibre11"> class </code>
            is a special keyword that indicates that we are defining an object.
          </li>
          <li class="calibre3">
            <code class="calibre11"> Post </code>
            is the name of our model. We can give it a different name (but we
            must avoid special characters and whitespace). Always start a class
            name with an uppercase letter.
          </li>
          <li class="calibre3">
            <code class="calibre11"> models.Model </code>
            means that the Post is a Django Model, so Django knows that it
            should be saved in the database.
          </li>
        </ul>
        <p class="calibre6">
          Now we define the properties we were talking about:
          <code class="calibre11"> title </code>
          ,
          <code class="calibre11"> text </code>
          ,
          <code class="calibre11"> created_date </code>
          ,
          <code class="calibre11"> published_date </code>
          and
          <code class="calibre11"> author </code>
          . To do that we need to define the type of each field (Is it text? A
          number? A date? A relation to another object, like a User?)
        </p>
        <ul class="calibre9">
          <li class="calibre3">
            <code class="calibre11"> models.CharField </code>
            – this is how you define text with a limited number of characters.
          </li>
          <li class="calibre3">
            <code class="calibre11"> models.TextField </code>
            – this is for long text without a limit. Sounds ideal for blog post
            content, right?
          </li>
          <li class="calibre3">
            <code class="calibre11"> models.DateTimeField </code>
            – this is a date and time.
          </li>
          <li class="calibre3">
            <code class="calibre11"> models.ForeignKey </code>
            – this is a link to another model.
          </li>
        </ul>
        <p class="calibre6">
          We will not explain every bit of code here since it would take too
          much time. You should take a look at Django's documentation if you
          want to know more about Model fields and how to define things other
          than those described above (
          <a
            href="https://docs.djangoproject.com/en/5.1/ref/models/fields/#field-types"
            target="_blank"
          >
            https://docs.djangoproject.com/en/5.1/ref/models/fields/#field-types
          </a>
          ).
        </p>
        <p class="calibre6">
          What about
          <code class="calibre11"> def publish(self): </code>
          ? This is exactly the
          <code class="calibre11"> publish </code>
          method we were talking about before.
          <code class="calibre11"> def </code>
          means that this is a function/method and
          <code class="calibre11"> publish </code>
          is the name of the method. You can change the name of the method if
          you want. The naming rule is that we use lowercase and underscores
          instead of spaces. For example, a method that calculates average price
          could be called
          <code class="calibre11"> calculate_average_price </code>
          .
        </p>
        <p class="calibre6">
          Methods often
          <code class="calibre11"> return </code>
          something. There is an example of that in the
          <code class="calibre11"> __str__ </code>
          method. In this scenario, when we call
          <code class="calibre11"> __str__() </code>
          we will get a text (
          <strong class="calibre10"> string </strong>
          ) with a Post title.
        </p>
        <p class="calibre6">
          Also notice that both
          <code class="calibre11"> def publish(self): </code>
          and
          <code class="calibre11"> def __str__(self): </code>
          are indented inside our class. Because Python is sensitive to
          whitespace, we need to indent our methods inside the class. Otherwise,
          the methods won't belong to the class, and you can get some unexpected
          behavior.
        </p>
        <p class="calibre6">
          If something is still not clear about models, feel free to ask your
          coach! We know it is complicated, especially when you learn what
          objects and functions are at the same time. But hopefully it looks
          slightly less magic for you now!
        </p>
        <h3 class="calibre12" id="create-tables-for-models-in-your-database">
          Create tables for models in your database
        </h3>
        <p class="calibre6">
          The last step here is to add our new model to our database. First we
          have to make Django know that we have some changes in our model. (We
          have just created it!) Go to your console window and type
          <code class="calibre11"> python manage.py makemigrations blog </code>
          . It will look like this:
        </p>
        <p class="calibre6"></p>
        <p class="calibre6">command-line</p>
        <p class="calibre6"></p>
        <pre
          class="calibre13"
        ><code class="calibre11">(myvenv) ~/djangogirls$ python manage.py makemigrations blog
        Migrations for 'blog':
          blog/migrations/0001_initial.py
            - Create model Post
        </code></pre>
        <p class="calibre6">
          <strong class="calibre10"> Note: </strong>
          Remember to save the files you edit. Otherwise, your computer will
          execute the previous version which might give you unexpected error
          messages.
        </p>
        <p class="calibre6">
          Django prepared a migration file for us that we now have to apply to
          our database. Type
          <code class="calibre11"> python manage.py migrate blog </code>
          and the output should be as follows:
        </p>
        <p class="calibre6"></p>
        <p class="calibre6">command-line</p>
        <p class="calibre6"></p>
        <pre
          class="calibre13"
        ><code class="calibre11">(myvenv) ~/djangogirls$ python manage.py migrate blog
        Operations to perform:
          Apply all migrations: blog
        Running migrations:
          Applying blog.0001_initial... OK
        </code></pre>
        <p class="calibre6">
          Hurray! Our Post model is now in our database! It would be nice to see
          it, right? Jump to the next chapter to see what your Post looks like!
        </p>
      </div>
    </main>
    <footer class="book-footer">
      <p>
        Generated from the original EPUB. Content © respective authors under CC
        BY-SA 4.0.
      </p>
    </footer>
    <script defer="" src="toc.js"></script>
    <script defer="" src="nav.js"></script>
  </body>
</html>
